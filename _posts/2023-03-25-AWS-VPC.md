---
key: jekyll-text-theme
title: 'AWS VPC'
excerpt: 'AWS Study 서비스 정리 - AWSKRUG Beginner Certification Study 😎'
tags: [AWS, SAA, cloud, study] 
---



# Networking

## CIDR 

### CIDR - IPv4  이해하기

* **CIDR = Classless Inter-Domain Routing**
* 클래스 없는 도메인 간 라우팅
* CIDR은 단순한 IP 범위를 정의하는 데 도움을 줌
  * /32로 끝나는 IP 주소: IP 하나만 나타냄
  * 0.0.0.0/0: 모든 IP
  * 192.168.0.0/26: IP 주소 64개

> **IPv4**
>
> 32비트인 IPv4는 흔히 사용하는 IP 주소, IP는 v4, v6 두 체계가 사용되며 IPv6 주소는 128비트
>
> IPv4  주소를 표기할 때는 4개의 옥텟(Octet)이라고 부르는 8비트 단위로 나누고, 각 옥텟은 "." 으로 구분함.
>
> 8비트의 옥텟은 10진수로 표기하므로 0 ~255의 값을 쓸 수 있음
>
> **참고문헌: IT 엔지니어를 위한 네트워크 입문 (고재성, 이상훈 지음)**



### CIDR 구성 요소

* **Base IP**
  * 범위에 포함된 IP (일반적으로는 범위의 시작이 되는데 범위 내부에 있기도 함)
  * 예시) 10.0.0.0 또는 192.168.0.0
* **Subnet Mask**
  *  IP에서 변경 가능한 비트의 개수 정의
  * 예시) /0, /24, /32
  * 형식은 두 가지
    * /8 은 서브넷 마크스 255.0.0.0와 동일
    * /16 은 서브넷 마크스 255.255.0.0과 동일
    * /24 는 서브넷 마스크 255.255.255.0과 동일
    * /32 는  서브넷 마스크 255.255.255.255와 동일

  * Base IP에서 변경할 수 있는 값을 정의하는 방법

     <img src = "https://user-images.githubusercontent.com/113915835/229335049-fbf21bd0-bbf3-4985-8f72-bbd703f09bc9.png" width="80%">

> **:fire:알아두면 유용한 링크**
>
> [https://www.ipaddressguide.com/cidr](https://www.ipaddressguide.com/cidr)



### 공용 IP vs 사설 IP

* IANA (Internet Assigned Numbers Authority) 에서 구축한 특정 IPv4 블록은 사설 LAN 네트워크 다시 말해 로컬 네트워크나 공용 인터넷 주소
* 사설 IP는 특정 값만 허용
  * 10.0.0.0/8 일 때 범위 (대형 네트워크에서 많이 씀)
    * 10.0.0.0 - 10.255.255.255 
  * 172.16.0.0/12 일 때 범위 (AWS 계정을 생성할 때 AWS에서 제공하는 기본 VPC는 해당 네트워킹 공간에 포함)
    * 172.16.0.0 - 172.31.255.255 
  * 192.168.0.0/16 일 때 범위 (홈 네트워크, 장치를 연결할 때 인터넷 라우터가 있을 경우 흔히 사용)
    * 192.168.0.0 - 192.168.255.255

      

## AWS VPC 소개

* **VPC = Virtual Private Cloud**
* 격리형 클라우드 리소스

## AWS VPC 특징

* 새로운 AWS 계정은 모두 기본 VPC가 있고 바로 사용 가능
* 새로운 EC2 인스턴스는 서브셋을 지정하지 않으면 기본 VPC에서 실행됨
* 기본 VPC는 처음부터 인터넷에 연결돼 있어서 인스턴스가 인터넷에 액세스하고 또 내부의 EC2 인스턴스는 공용 IPv4 주소를 얻음 (EC2 인스턴스를 생성하지마자 연결할 수 있는 이유)
* EC2 인스턴스를 위한 공용 및 사설 IPv4 DNS 이름 얻음

## VPC Diagram

<img src = "https://user-images.githubusercontent.com/113915835/229334403-4c6d752a-3271-4a86-8a29-f3c9e6c7b5ef.png" width ="80%">

## Subnet

### Adding Subnet

<img src ="https://user-images.githubusercontent.com/113915835/229363855-e5e26d75-db9b-4718-b088-e9dad1443c80.png" width = "80%">

### Subnet 이란?

* VPC 내부에 있는 IPv4 주소의 부분 범위
* 이 범위 내에서 AWS가 IP 주소 다섯 개를 예약함
  * IP 주소 처음 네 개, 마지막 한 개를 서브넷 마다 예약
  * 예시) CIDR 블록 10.0.0.0/24
    * 10.0.0.0: Network Address
    * 10.0.0.1: VPC 라우터 용
    * 10.0.0.2: Amazon 제공 DNS에 매핑
    * 10.0.0.3: 당장 사용하지 않지만 나중에 필요할 수 있으니 예약
    * 10.0.0.255: 네트워크 브로드캐스트 주소, AWS는 VPC에서 브로드캐스트를 지원하지 않기 때문에 예약은 되지만 사용은 안됨
* **EC2 인스턴스 서브넷에서 IP 주소 29개가 필요할 때 /27 서브넷은 사용 못 함.**:star:
  * /27 IP 주소는 32개인데 예약된 주소 5개 제외하면 27개만 남기 때문 -> 서브넷 크기는 /26 이어야 함 (/26은 서브넷에 IP 주소 64개를 제공. 예약된 주소 5개를 제외하고도 59개가 되기 때문에 필요한 29개보다 훨씬 많음)

## Internet Gateway (IGW)

### Adding IGW

<img src = "https://user-images.githubusercontent.com/113915835/229364608-7bebfff0-230c-43a5-bbb8-985d4c446d44.png" width = "80%">

### Internet Gateway 소개

* IGW는 VPC 리소스를 인터넷에 연결하도록 허용하는 EC2 인스턴스나 Lambda 함수 등임
* 수평으로 확장되고 가용성과 중복성이 높음 (좋은 관리형 리소스)
* VPC와는 별개로 생성해야 하고, VPC는 IGW 하나에만 연결됨 / IGW 자체는 인터넷 액세스를 허용하지 않음
* VPC에 IGW를 만드는 것만으로는 서브넷에 인터넷 액세스를 제공할 수 없음!  -> 아래와 같이(Editing Route Table Diagram) 라우팅 테이블(Routing Table)을 수정해서 EC2 인스턴스를 라우터에 연결하고 IGW에 연결해야 함

### Editing Route Table

<img src = "https://user-images.githubusercontent.com/113915835/229364856-721e80aa-3eed-440e-a1ce-1908cfdeb364.png" width = "80%">

* 공용 서브넷에 공용 EC2 인스턴스를 만들고 라우팅 테이블을 수정해서 EC2 인스턴스를 라우터에 연결하고 IGW에 연결 -> IGW가 인터넷과 연결될 수 있음



## Bastion Hosts

### Bastion Hosts 소개

* Bastion Hosts를 통해 Private EC2 인스턴스에 SSH로 액세스할 수 있음
* 이 때 Bastion Hosts는 반드시 퍼블릭 서브넷에 있어야 함
* Bastion Hosts를 사용하려면 보안 그룹이 반드시 인터넷 액세스를 허용해야 함
* Private 서브넷의 EC2 인스턴스 보안 그룹에서는 반드시 SSH 액세스를 허용해야 함
  * 22 port 가 Bastion Hosts의 Private IP가 되거나 보안 그룹이 되는 셈 (EC2 인스턴스가 Bastion Hosts를 이용하여 연결되기 때문)

<img src = "https://user-images.githubusercontent.com/113915835/229365598-f1c4d895-cb99-4285-84d2-058eb6fac1d9.png" width ="40%">

## NAT Instance (Outdated)

## NAT Instance 소개

* **NAT = Network Address Translation**
* NAT  인스턴스는 사설 서브넷 EC2 인스턴스가 인터넷에 연결되도록 허용



### NAT Instance 특징

<img src ="https://user-images.githubusercontent.com/113915835/229548123-99db5f71-3a51-464f-ad51-cbb46b30573c.png" width = "40%">

* NAT Instance는 공용 서브넷에서 실행되어야 하고, 공용 및 사설 서브넷을 연결해야 함
* **비활성화 해야하는 설정**:  **소스/목적지 확인**
* NAT 인스턴스에는 고정된 탄력적 IP가 연결되어야 함
* 라우팅 테이블을 수정하여 사설 서브넷과 공용 서브넷의 두 서브넷에 있는 EC2 인스턴스로부터 NAT 인스턴스로 트래픽을 전송하도록 함
* NAT 인스턴스는 가용성이 높지 않고 초기화 설정으로 복원할 수 없어서 여러 가용 영역 (AZ)에 ASG (Auto Scaling Group)를 생성해야 하고 복원되는 사용자 데이터 스크립트가 필요하기에 꽤 복잡함.
  * 작은 인스턴스는 큰 인스턴스에 비교해서 대역폭이 더 작음
* 보안 그룹과 규칙을 관리해야 함
  * Inbound: 사설 서브넷의 HTTP/HTTPS 트래픽을 허용, 홈 네트워크의 SSH도 허용
  * Outbound: 트래픽이 나가도록 함 (Allow HTTP/HTTPS traffic to the Internet)

### NAT Instance Diagram

<img src = "https://user-images.githubusercontent.com/113915835/229550951-1de1a6b2-a24b-457a-bda1-bf194ec71c0b.png" width = "80%">

* NAT 인스턴스의 작동방식

  * 공용 서브넷에 NAT 인스턴스를 생성하고, 생성한 NAT 인스턴스에 탄력적 IP를 연결함

  * 라우팅 테이블을 통해 사설 인스턴스가 NAT 인스턴스에서 인터넷 Gateway까지 통신하도록 함

    





<br/>

> **REFERENCE**
>
> [https://www.udemy.com/](https://www.udemy.com/) (AWS Certified Solutions Architect Associate, Stephane Maarek)
>
> [https://docs.aws.amazon.com/?nc2=h_ql_doc_do](https://docs.aws.amazon.com/?nc2=h_ql_doc_do)