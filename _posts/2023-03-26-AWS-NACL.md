---
key: jekyll-text-theme
title: 'NACL'
excerpt: 'AWS Study 서비스 정리 - AWSKRUG Beginner Certification Study 😎'
tags: [AWS, SAA, cloud, study, Networking]
---





# Networking



## NACL :star:

### NACL 소개

* **NACL = Network Access Control List**
* 서브넷을 오가는 트래픽을 제어하는 방화벽과 비슷
* 서브넷 보안 단계

### Security Groups & NACL

* 언제 보안 그룹이 연결된 EC2 인스턴스를 사용하는 지 보자

<img src = "https://user-images.githubusercontent.com/113915835/231197561-424745d6-3afb-43d3-a60b-70309de514a5.png" width = "80%">

#### Incoming Request

:mag_right:  **들어오는 요청의 NACL 역할**

1. 요청이 서브넷에 들어가기 전 먼저 NACL로 이동
2. NACL에는 몇 가지의 인바운드 규칙이 정의되며, 요청이 허용되지 않으면 내부로 들어갈 수 없음 (NACL은 무상태)
3. 첫 번째 요청이 NACL을 통과해서 서브넷 내부에 도달
4. 보안 그룹 인바운드 규칙 만남 (보안 그룹의 특징은 상태 유지)

> :star:**NACL은 무상태이고 보안 그룹은 상태 유지?**
>
> 요청이 보안 그룹의 인바운드 규칙을 통과해서 EC2 인스턴스에 도달하면 EC2 인스턴스는 그 응답으로 애플리케이션 관점에서 응답할 내용을 모두 회신. 아웃바운드 규칙은 자동으로 보안 그룹 수준에서 허용 (보안 그룹의 특징이 상태 유지이기 때문) -> 들어가는 건 전부 나올 수 있음. 따라서 평가되는 규칙이 없음.
>
> :star:**보안 그룹 수준에서 아웃바운드 규칙이 항상 허용되는 이유가 상태 유지. 왜?**
>
> NACL은 무상태(상태 없음) -> 무상태이기 때문에 NACL 아웃바운드의 규칙이 평가됨 규칙이 통과하지 못하면 요청도 통과하지 못함.



#### Outgoing Request

**:mag_right: 보안 그룹에서 EC2 인스턴스가 아웃바운드 요청** (외부로 바인딩 된 요청을 하는 것)

1.  EC2 인스턴스는 먼저 www.google.com 등에 접속
2.  처음으로 평가될 규칙은 보안 그룹 아웃바운드 규칙
 * 트래픽이 EC2 인스턴스에서 웹으로 나가도록 허용할 지 결정
3.  규칙이 적절하고 요청이 허가되면 요청은 NACL 아웃바운드 규칙을 통과함
4.  이렇게 평가된 요청이 www. google.com에 도달하고 AWS로 다시 돌아오는 것
 * NACL이 무상태라서 NACL 인바운드 규칙이 평가될 수 있음
 * 마지막으로 보안 그룹 수준에서 서브넷의 인바운드 규칙은 무조건 허용됨 (보안 그룹 규칙의 상태 유지 특징 때문)
 * 보안 그룹 인바운드 규칙은 동일함 (아웃바운드 규칙은 이미 허용되었고 보안 그룹은 상태 유지이기 때문)

### NACL 특징

<img src = "https://user-images.githubusercontent.com/113915835/232535064-f7486883-664f-4070-ad22-1254d70c83a9.png" width = "80%">

* 서브넷마다 하나의 NACL이 있음  (One NACL per subnet)
* 새로운 서브넷에는 Default NACL이 할당됨
* NACL은 공용 서브넷 및 사설 서브넷 등에 위치해 있음
* 서브넷 수준에서 특정한 IP 주소를 차단하는데 적합함 (NACL의 좋은 사용 사례)

* Default NACL은 연결된 서브넷을 가지고 인바운드와 아웃바운드의 모든 요청을 허용하는 특수성을 가짐 
  * Default NACL은 매우 개방적임 (기본 NACL은 수정하지 않는 것을 추천함)
  * IPv4를 지원하는 Default NACL의 특징 (이미지 참고)
    * 모든 것이 나가고 들어올 수 있음

<img src = "https://user-images.githubusercontent.com/113915835/232531136-e4e12be1-8e57-4049-9e51-34367dfb2445.png" width = "80%">



### NACL 규칙 정의

* 범위: 1 - 32,766
  * 숫자가 낮을수록 우선 순위가 높음 (우선 순위가 가장 높은 것은 1, 가장 낮은 것은 32,766)
* 첫 번째 규칙 비교로 결정이 됨
  * 예시) CIDR에서 Allow를 정의하고, 같은 CIDR인 특정IP를 Deny로 정의하면 Allow는 100이고 Deny는 200이니까 IP 주소가 허용됨.  (100이 200보다 우선하기 때문)
* 별표(*) 규칙
  * 일치하는 규칙이 없으면 모든 요청을 거부함
  * AWS에서는 규칙을 100씩 추가하는 것을 권장함

```
새로 만들어진 NACL은 기본적으로 모두 거부함
```



### Ephemeral Ports (임시 포트)

* 클라이언트와 서버가 연결되려면 포트를 사용해야 함 (IP 주소와 포트가 존재)
* 클라이언트는 규정된 포트의 서버에 연결
  * HTTP 포트: 80
  * HTTPS 포트: 443
  * SSH 포트: 22
* 서버가 서비스를 올릴 때 클라이언트는 규정된 포트에 접속함 (단, 클라이언트가 서버에서 회신받을 때는 제외)
* 서버도 클라이언트에 연결해야 함
  * 클라이언트는 기본적으로 개방된 포트가 없어서 클라이언트가 서버에 접속할 때 자체적으로 특정한 포트를 열게 됨
  * 이 포트는 임시포트라서 클라이언트와 서버 간 연결이 유지되는 동안만 열려 있음
* 임시 포트란?
  * OS(운영체제)에 따라 포트 범위가 달라짐
    * Windows10: 49,152 ~ 65,535
    * Linux: 32,768 ~ 60,999










<br/>

> **REFERENCE**
>
> [https://www.udemy.com/](https://www.udemy.com/) (AWS Certified Solutions Architect Associate, Stephane Maarek)
>
> [https://docs.aws.amazon.com/?nc2=h_ql_doc_do](https://docs.aws.amazon.com/?nc2=h_ql_doc_do)