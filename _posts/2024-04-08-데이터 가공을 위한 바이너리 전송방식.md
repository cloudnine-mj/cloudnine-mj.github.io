---
key: jekyll-text-theme
title: 'ë°ì´í„° ê°€ê³µì„ ìœ„í•œ Binary ì „ì†¡ë°©ì‹'
excerpt: 'JSON, AVRO ğŸ˜'
tags: [KsqlDB, JSON/AVRO, ë°ì´í„° ê°€ê³µ]
---

# ë°ì´í„° ê°€ê³µì„ ìœ„í•œ ë°”ì´ë„ˆë¦¬ ì „ì†¡ë°©ì‹ ì„ íƒ

* ì¹´í”„ì¹´ì—ì„œ ë°ì´í„°ë¥¼ ì „ì†¡ í•  ëŒ€ ì§ë ¬í™”(serialize)ë¥¼ í†µí•´ ë°”ì´ë„ˆë¦¬ ë°°ì—´ë¡œ ë³€í™˜í•´ì•¼í•œë‹¤. ê·¸ ì´ìœ ëŠ” ì–´ë–¤ ê°’ì„ ì°¸ì¡°í•˜ëŠ” ì£¼ì†Œê°€ ë‹´ê¸´ ë³€ìˆ˜ë¥¼ ì €ì¥í•œë‹¤ê³  í–ˆì„ ë•Œ, ë‹¤ì‹œ ë¶ˆëŸ¬ì˜¤ê²Œ ëœë‹¤ê³  í•´ë„ ê°€ë¦¬í‚¤ë˜ ê°’ì˜ ì£¼ì†Œê°€ ë‹¬ë¼ì§€ê¸° ë•Œë¬¸ì— ì˜ë¯¸ê°€ ì—†ê¸° ë•Œë¬¸, ê·¸ë˜ì„œ ì°¸ì¡°ê°’ì€ ì €ì¥í•˜ê±°ë‚˜ ë³´ë‚¼ ìˆ˜ ì—†ê³  ê°’ë§Œ ì €ì¥í•˜ê±°ë‚˜ ë³´ë‚¼ ìˆ˜ ìˆë‹¤.

## JSON

* ìŠ¤í‚¤ë§ˆê°€ ë”°ë¡œ ì—†ì´ ìƒì„± ê°€ëŠ¥

* ë°ì´í„°ë¥¼ ë³´ë‚¼ ë•Œ ì „ë¶€ ë³´ë‚´ì•¼í•˜ëŠ” ë¶ˆí¸í•¨ì´ ì¡´ì¬

### Databaseì˜ source í…Œì´ë¸” ìƒì„±

```
mariaDB> create table udf_test (
id int primary key auto_increment, 
c1 int, 
c2 int, 
c3 int, 
c4 int);
```

### Connector ìƒì„±

```
curl -XPOST http://192.168.2.52:30099/connectors/
{
    "name": "simple-udf",
    "config": {
        "connector.class" : "io.confluent.connect.jdbc.JdbcSourceConnector",
        "connection.url" : "jdbc:mariadb://mariadb:3306/connectTest",
        "connection.user" : "root",
        "connection.password" : "secret",
        "topic.prefix" : "simple_udf_",
        "mode" : "incrementing",
        "incrementing.column.name" : "id",
        "table.whitelist": "udf_test",
        "topic.creation.default.replication.factor" : 2,
        "topic.creation.default.partitions" : 3,
        "poll.interval.ms" : 2000,
        "key.converter": "org.apache.kafka.connect.json.JsonConverter",
        "value.converter": "org.apache.kafka.connect.json.JsonConverter",
        "value.converter.schemas.enable": "false",
        "key.converter.schemas.enable": "false",
        "max.tasks": 1
    }
}
```

###  ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ stream ìƒì„±

```
ksql > create stream test1(
id int key,
c1 int,
c2 int,
c3 int,
c4 int
) with (
kafka_topic='simple_udf_udf_test',
value_format='JSON');

ksql> describe  TEST1;

Name                 : TEST1
 Field | Type                   
--------------------------------
 ID    | INTEGER          (key) 
 C1    | INTEGER                
 C2    | INTEGER                
 C3    | INTEGER                
 C4    | INTEGER                
--------------------------------
```

* ë‹¤ë¥¸ streamì„ ì°¸ì¡°í•˜ì—¬ UDFê²°ê³¼ë¥¼ ì €ì¥í•˜ëŠ” stream ìƒì„±

```
#databseì— ë°ì´í„° insert
MariaDB [connectTest]> insert into udf_test(c1, c2, c3, c4) values(1,2,3,4);
Query OK, 1 row affected (0.00 sec)

MariaDB [connectTest]> insert into udf_test(c1, c2, c3, c4) values(2,3,4,6);
Query OK, 1 row affected (0.02 sec)


#kafka consumerì—ì„œ data í™•ì¸
[kafka@kafka-cluster-kafka-0 bin]$ ./kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic simple_udf_udf_test --from-beginning
{"id":17,"c1":1,"c2":2,"c3":3,"c4":4}
{"id":18,"c1":2,"c2":3,"c3":4,"c4":6}

#streamì—ì„œ udf ê²°ê³¼ í™•ì¸
ksql> create stream results AS 
>select TEST_UDF(c1, c2, c3, c4) FROM test2;

 Message                               
---------------------------------------
 Created query with ID CSAS_RESULTS_89 
---------------------------------------
ksql> select * from results EMIT CHANGES;
+-----------------------------------------------------------------------------------------------------------+
|KSQL_COL_0                                                                                                 |
+-----------------------------------------------------------------------------------------------------------+

|2.0                                                                                                        |
|4.0                                                                                                        |

Press CTRL-C to interrupt
```


## AVRO

* schema registryì— schemaë¥¼ ì €ì¥í•˜ê³  ë°ì´í„°ë¥¼ ì „ì†¡í• ë•Œ schemaì˜ idë§Œ ì§€ì •í•´ì£¼ë©´ ëœë‹¤.

