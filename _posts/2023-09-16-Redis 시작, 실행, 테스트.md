---
key: jekyll-text-theme
title: 'Redis ì‹œì‘í•˜ê¸°'
excerpt: 'Redis ì‹œì‘, ì‹¤í–‰, í…ŒìŠ¤íŠ¸í•˜ê¸° ğŸ˜'
tags: [Redis, DB]
---

# Redis

ğŸ‘‰ Docs : [https://redis.io/download/](https://redis.io/download/)

## Redis ì„¤ì¹˜

- ì»´íŒŒì¼ì„ í•˜ë¯€ë¡œ gccë„ ìˆì–´ì•¼ ë¨

```
apt-get update 
apt install gcc 
```

- ë‹¤ìš´ë¡œë“œ

```
wget <https://download.redis.io/releases/redis-6.0.9.tar.gz>
tar -xvf redis-6.0.9.tar.gz
```

- makeë¥¼ ì‹¤í–‰í•˜ë˜, ë””íœë˜ì‹œ ë¬¸ì œê°€ ìˆì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë¨¼ì € ìˆ˜í–‰í•´ë„ ë¨.

```
cd deps/
make jemalloc
make hiredis
make linenoise
make lua 
```

- make & ì†ŒìŠ¤ ì„¤ì¹˜

```
make
make install
```

- redis-serverê°€ ìˆë‹¤ë©´ ì„¤ì¹˜ëŠ” ì¼ë‹¨ ëë‚œ ê²ƒì„.

```
ls src/ | grep redis-server
redis-server
```

## Redis ì„¤ì •

- 3ëŒ€ì˜ ì¥ë¹„ë¡œ í•œ ëŒ€ë‹¹ master, slave ì¸ìŠ¤í„´ìŠ¤ë¥¼ í•˜ë‚˜ì”© ì˜¬ë¦´ ê²ƒì„.  ì‹¤ì œ ë¬¼ë¦¬ ì„œë²„ë¼ ì¹˜ë©´ 6ëŒ€.
- hostnameì„ ë¶„ë¦¬í•´ë„ ë˜ê² ì§€ë§Œ, ì¼ë‹¨ 0.0.0.0ìœ¼ë¡œ í•¨.
- 6ëŒ€ ë‹¤ ë¶„ë¦¬í–ˆë‹¤ë©´ í¬íŠ¸ë²ˆí˜¸ë„ ì‚¬ì‹¤ ë³€ê²½í•  í•„ìš”ëŠ” ì—†ë‹¤. ê°™ì€ ì¥ë¹„ì— ë‘ê°œ ì˜¬ë ¤ì•¼ í•˜ë‹ˆ master = 6300. slave = 6400ìœ¼ë¡œ í†µì¼í•¨.

```
# redis.conf í•´ë‹¹ ì†ì„± ë³€ê²½ - master
bind 0.0.0.0
port 6300

# redis.conf í•´ë‹¹ ì†ì„± ë³€ê²½ - slave
bind 0.0.0.0
port 6400
```

## Redis ì‹¤í–‰

- cluster-enableë“±ì˜ ê°’ì€ ì‹¤í–‰ ì¸ìë¡œ ì£¼ê²Œ ì„¤ì •í•¨.
- ê°™ì€ ì¥ë¹„ì—ì„œ ì‹¤í–‰í•˜ë¯€ë¡œ node ê´€ë ¨ ì •ë³´ëŠ” ë¶„ë¦¬í•´ì„œ ì €ì¥í•˜ê²Œ í•¨(master.conf, slave.conf) ë§Œì•½ 6ëŒ€ê°€ ë‹¤ ë‹¤ë¥¸ ì¥ë¹„ë¼ë©´ ì“°ì§€ ì•Šì•„ë„ ê´œì°®ì„ ê²ƒ ê°™ë‹¤.
- cluster-config-file ì¸ìë¡œ ë³€ê²½í•  ìˆ˜ ìˆìŒ.

```
# master 3ëŒ€ ì¥ë¹„ ì‹¤í–‰
src/redis-server redis_6300.conf --cluster-enabled yes --cluster-config-file master.conf

# slave 3ëŒ€ ì¥ë¹„ ì‹¤í–‰
src/redis-server redis_6400.conf --cluster-enabled yes --cluster-config-file slave.conf
```

```
18775:C 15 Sep 2023 05:58:59.910 # oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo
18775:C 15 Sep 2023 05:58:59.910 # Redis version=6.0.9, bits=64, commit=00000000, modified=0, pid=18775, just started
18775:C 15 Sep 2023 05:58:59.910 # Configuration loaded
18775:M 15 Sep 2023 05:58:59.910 * Increased maximum number of open files to 10032 (it was originally set to 1024).
18775:M 15 Sep 2023 05:58:59.910 * Node configuration loaded, I'm 372539a6649ce5c0e7714d53e2580d02e527a4fc
                _._                                                  
           _.-``__ ''-._                                             
      _.-``    `.  `_.  ''-._           Redis 6.0.9 (00000000/0) 64 bit
  .-`` .-```.  ```\\/    _.,_ ''-._                                   
 (    '      ,       .-`  | `,    )     Running in cluster mode
 |`-._`-...-` __...-.``-._|'` _.-'|     Port: 6300
 |    `-._   `._    /     _.-'    |     PID: 18775
  `-._    `-._  `-./  _.-'    _.-'                                   
 |`-._`-._    `-.__.-'    _.-'_.-'|                                  
 |    `-._`-._        _.-'_.-'    |           <http://redis.io>        
  `-._    `-._`-.__.-'_.-'    _.-'                                   
 |`-._`-._    `-.__.-'    _.-'_.-'|                                  
 |    `-._`-._        _.-'_.-'    |                                  
  `-._    `-._`-.__.-'_.-'    _.-'                                   
      `-._    `-.__.-'    _.-'                                       
          `-._        _.-'                                           
              `-.__.-'
```

- ì´ì œ í´ëŸ¬ìŠ¤í„°ë¥¼ ë§ºê²Œ ë§Œë“ ë‹¤. ì£¼ì†Œì™€ í¬íŠ¸ë¡œ ì„¸ê°œ ë„£ì–´ì£¼ë©´ ë¨. ì•„ì§ masterë§Œ ë§Œë“¤ì–´ì ¸ ìˆëŠ” ì…ˆì´ë‹¤.
- RedisëŠ” í•´ì‹œ ìŠ¬ë¡¯ì„ í†µí•´ ë¶„ì‚° ì²˜ë¦¬í•˜ëŠ”ë°, ê´€ë ¨ ìŠ¬ë¡¯ì„ í• ë‹¹í•˜ê³  ë¶„ë°°í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.



```
# src/redis-cli --cluster create 10.0.0.8:6300 10.0.0.186:6301 10.0.0.138:6302

# src/redis-cli --cluster create 10.0.0.8:6300 10.0.0.186:6301 10.0.0.138:6302
>>> Performing hash slots allocation on 3 nodes...
Master[0] -> Slots 0 - 5460
Master[1] -> Slots 5461 - 10922
Master[2] -> Slots 10923 - 16383
M: 372539a6649ce5c0e7714d53e2580d02e527a4fc 10.0.0.8:6300
   slots:[0-5460] (5461 slots) master
M: 5096811d632da16eabf6f1c739dcb50569de21f6 10.0.0.186:6301
   slots:[5461-10922] (5462 slots) master
M: fd7d90cb75e3f3cfa1f078b9fe7800bc4814e3c3 10.0.0.138:6302
   slots:[10923-16383] (5461 slots) master
Can I set the above configuration? (type 'yes' to accept): yes
>>> Nodes configuration updated
>>> Assign a different config epoch to each node
>>> Sending CLUSTER MEET messages to join the cluster
Waiting for the cluster to join
.

.
>>> Performing Cluster Check (using node 10.0.0.8:6300)
M: 372539a6649ce5c0e7714d53e2580d02e527a4fc 10.0.0.8:6300
   slots:[0-5460] (5461 slots) master
M: fd7d90cb75e3f3cfa1f078b9fe7800bc4814e3c3 10.0.0.138:6302
   slots:[10923-16383] (5461 slots) master
M: 5096811d632da16eabf6f1c739dcb50569de21f6 10.0.0.186:6301
   slots:[5461-10922] (5462 slots) master
[OK] All nodes agree about slots configuration.
>>> Check for open slots...
>>> Check slots coverage...
[OK] All 16384 slots covered.
```

- ì¸ìŠ¤í„´ìŠ¤ ë¡œê·¸

```
18716:M 15 Sep 2023 05:23:43.457 # Configuration change detected. Reconfiguring myself as a replica of bbfdaa4e1f712150fea5e2b2ade058769cddc92f
18716:S 15 Sep 2023 05:23:43.457 * Before turning into a replica, using my own master parameters to synthesize a cached master: I may be able to synchronize with the new master with just a partial transfer.
18716:S 15 Sep 2023 05:23:43.457 # Cluster state changed: ok
18716:S 15 Sep 2023 05:23:44.459 * Connecting to MASTER 10.0.0.8:6400
18716:S 15 Sep 2023 05:23:44.459 * MASTER <-> REPLICA sync started
18716:S 15 Sep 2023 05:23:44.459 * Non blocking connect for SYNC fired the event.
18716:S 15 Sep 2023 05:23:44.459 * Master replied to PING, replication can continue...
18716:S 15 Sep 2023 05:23:44.459 * Trying a partial resynchronization (request 5fa9d45993bac7c02adec25ebfc74921a0cc9fd0:1).
18716:S 15 Sep 2023 05:23:44.459 * Full resync from master: dbcce2eabb56a69d5912f33ba3ed6b9d747dfaae:322
18716:S 15 Sep 2023 05:23:44.459 * Discarding previously cached master state.
18716:S 15 Sep 2023 05:23:44.523 * MASTER <-> REPLICA sync: receiving 176 bytes from master to disk
18716:S 15 Sep 2023 05:23:44.524 * MASTER <-> REPLICA sync: Flushing old data
18716:S 15 Sep 2023 05:23:44.524 * MASTER <-> REPLICA sync: Loading DB in memory
18716:S 15 Sep 2023 05:23:44.528 * Loading RDB produced by version 6.0.9
18716:S 15 Sep 2023 05:23:44.528 * RDB age 0 seconds
18716:S 15 Sep 2023 05:23:44.528 * RDB memory usage when created 2.52 Mb
18716:S 15 Sep 2023 05:23:44.528 * MASTER <-> REPLICA sync: Finished with success
```

- masterëŠ” ëª¨ë‘ ë§Œë“¤ì–´ì¡Œìœ¼ë‹ˆ, ì´ë²ˆì—” slave ë…¸ë“œë¥¼ ë¶™ì—¬ë³¸ë‹¤.
- ì£¼ì˜í•  ì  : `add-node <slave> <master> --cluster-slave` ìˆœì„œì´ë¯€ë¡œ, masterì™€ slaveë¥¼ í—·ê°ˆë¦¬ë©´ ì•ˆë¨ :star:

```
# src/redis-cli --cluster add-node 10.0.0.186:6401 10.0.0.186:6301 --cluster-slave

>>> Adding node 10.0.0.186:6401 to cluster 10.0.0.186:6301
>>> Performing Cluster Check (using node 10.0.0.186:6301)
M: 5096811d632da16eabf6f1c739dcb50569de21f6 10.0.0.186:6301
   slots:[5461-10922] (5462 slots) master
M: 372539a6649ce5c0e7714d53e2580d02e527a4fc 10.0.0.8:6300
   slots:[0-5460] (5461 slots) master
   1 additional replica(s)
S: bbfdaa4e1f712150fea5e2b2ade058769cddc92f 10.0.0.8:6400
   slots: (0 slots) slave
   replicates 372539a6649ce5c0e7714d53e2580d02e527a4fc
M: fd7d90cb75e3f3cfa1f078b9fe7800bc4814e3c3 10.0.0.138:6302
   slots:[10923-16383] (5461 slots) master
[OK] All nodes agree about slots configuration.
>>> Check for open slots...
>>> Check slots coverage...
[OK] All 16384 slots covered.
Automatically selected master 10.0.0.186:6301
>>> Send CLUSTER MEET to node 10.0.0.186:6401 to make it join the cluster.
Waiting for the cluster to join

>>> Configure node as replica of 10.0.0.186:6301.
[OK] New node added correctly.
```

- ê° master ë³„ë¡œ ë‹¤ í•´ì£¼ë©´ ë¨.

```
# src/redis-cli --cluster add-node 10.0.0.8:6400 10.0.0.8:6300 --cluster-slave
# src/redis-cli --cluster add-node 10.0.0.138:6402 10.0.0.138:6302 --cluster-slave
```

# redis-cli

- redis-cliëŠ” Redis  Client í”„ë¡œê·¸ë¨ìœ¼ë¡œ, interactive ì…¸ë¡œ ì§€ì›ëœë‹¤.
- ì•„ë¬´ ì˜µì…˜ë„ ì£¼ì§€ ì•Šìœ¼ë©´ 127.0.0.1:6379ë¡œ ì ‘ì†í•˜ê²Œ ë˜ë‹ˆ -hë‚˜ -p ì˜µì…˜ì„ ì¤˜ì•¼ í•œë‹¤.

```
# src/redis-cli -p 6300
127.0.0.1:6300>
```

- í´ëŸ¬ìŠ¤í„°ê°€ ì˜ ë§ºì–´ì ¸ ìˆëŠ”ì§€ í™•ì¸

```
127.0.0.1:6300> cluster nodes
6a6578cf994f2e392635f8ad0bb7c75652510d1a 10.0.0.138:6402@16402 slave fd7d90cb75e3f3cfa1f078b9fe7800bc4814e3c3 0 1694758133040 3 connected
bbfdaa4e1f712150fea5e2b2ade058769cddc92f 10.0.0.8:6400@16400 master - 0 1694758136045 4 connected 0-5460
be2300fb37c572b5ffd04e2a8bc39bc31a954938 10.0.0.186:6401@16401 slave 5096811d632da16eabf6f1c739dcb50569de21f6 0 1694758135044 2 connected
5096811d632da16eabf6f1c739dcb50569de21f6 10.0.0.186:6301@16301 master - 0 1694758134000 2 connected 5461-10922
372539a6649ce5c0e7714d53e2580d02e527a4fc 10.0.0.8:6300@16300 myself,slave bbfdaa4e1f712150fea5e2b2ade058769cddc92f 0 1694758134000 4 connected
fd7d90cb75e3f3cfa1f078b9fe7800bc4814e3c3 10.0.0.138:6302@16302 master - 0 1694758134041 3 connected 10923-16383
127.0.0.1:6300> cluster info
cluster_state:ok
cluster_slots_assigned:16384
cluster_slots_ok:16384
cluster_slots_pfail:0
cluster_slots_fail:0
cluster_known_nodes:6
cluster_size:3
cluster_current_epoch:4
cluster_my_epoch:4
cluster_stats_messages_ping_sent:616
cluster_stats_messages_pong_sent:648
cluster_stats_messages_sent:1264
cluster_stats_messages_ping_received:648
cluster_stats_messages_pong_received:616
cluster_stats_messages_received:1264
```

- ë°ì´í„° ë„£ê³  í™•ì¸í•˜ëŠ” ë°©ë²•

```
127.0.0.1:6400> set keyname "test"
OK
127.0.0.1:6400> lpush listname "testlist"
(integer) 1
127.0.0.1:6400> lpush listname "testlist" "test1"
(integer) 3
127.0.0.1:6400> lpush listname "testlist1"
(integer) 4
127.0.0.1:6400> lrange listname 0 -1
1) "testlist1"
2) "test1"
3) "testlist"
4) "testlist"
```
