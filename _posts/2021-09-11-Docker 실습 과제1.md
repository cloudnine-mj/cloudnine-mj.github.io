---
key: jekyll-text-theme
title: 'Docker ì‹¤ìŠµ ê³¼ì œ1'
excerpt: ' Docker/K8s ê³µë¶€í•˜ê¸°ğŸ˜'
tags: [Docker, K8s]
---


# ì‹¤ìŠµ ê³¼ì œ

ë„ì»¤/ì¿ ë²„ë„¤í‹°ìŠ¤ ì˜¨ë¼ì¸ ë¶€íŠ¸ìº í”„ with ì¹´ì¹´ì˜¤ì—”í„°í”„ë¼ì´ì¦ˆ Docker ì‹¤ìŠµ ê³¼ì œ

## 5ì£¼ì°¨ ê³¼ì œ

### ì§„í–‰ë‹¨ê³„

* Chapter05 ë„ì»¤ ë ˆì§€ìŠ¤íŠ¸ë¦¬` ìˆ˜ê°• í›„ `Chapter06 ë„ì»¤ ë³¼ë¥¨ / ë„¤íŠ¸ì›Œí¬` ìˆ˜ê°• ì „
* 2021ë…„ 9ì›” 10ì¼ê¹Œì§€ ì œì¶œ ì™„ë£Œ

### ê³¼ì œ ì„¤ëª…

1. ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±

- 80í¬íŠ¸ë¥¼ `Dockerfile`ì— ëª…ì‹œ
- ì›¹ ì„œë²„ ì´ë¯¸ì§€ë¥¼ ì»¨í…Œì´ë„ˆë¡œ ì‹¤í–‰í•  ë•Œ, `Connection Established` ë©”ì‹œì§€ë¥¼ ì½˜ì†”ì— ì¶œë ¥
  - í•´ë‹¹ ì¡°ê±´ ì‚­ì œ
- health ì²´í¬
  - ì»¨í…Œì´ë„ˆ ìƒíƒœë¥¼ 2ì´ˆ ê°„ê²©ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§
  - íƒ€ì„ì•„ì›ƒ ì‹œê°„ì„ 5ì´ˆë¡œ ì„¤ì •
  - ì ‘ì†ì´ 5ë²ˆ ì´ìƒ ì‹¤íŒ¨í•˜ë©´ ë¹„ì •ìƒìœ¼ë¡œ ì„¤ì •

2. ìƒì„±í•œ ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ë„ì»¤ í—ˆë¸Œì— ì—…ë¡œë“œ

- ë„ì»¤ í—ˆë¸Œì— ë¡œê·¸ì¸ í›„ ì €ì¥ì†Œë¥¼ ìƒì„±í•˜ì—¬ ìƒì„±í•œ ì´ë¯¸ì§€ ì—…ë¡œë“œ
  - ë‹¤ë¥¸ ìœ ì €ê°€ í™•ì¸ ê°€ëŠ¥í•˜ë„ë¡ ì €ì¥ì†Œë¥¼ `public` ì„¤ì •
  - ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•  ë•Œ ì´ë¯¸ì§€ íƒœê·¸ëŠ” 1.0ìœ¼ë¡œ ì„¤ì •

### ì‘ì—…

* Dockerfile ìˆ˜ì •

  ```
  FROM nginx:alpine
  WORKDIR /usr/share/nginx/html
  RUN rm -rf ./*
  COPY ./* ./
  
  EXPOSE 80
  
  # Add exec permission to sh
  #RUN chmod +x ./docker-entrypoint.sh
  #ENTRYPOINT ["./docker-entrypoint.sh"]
  #CMD ["nginx", "-g", "daemon off;"]
  
  ENTRYPOINT ["nginx", "-g", "daemon off;"]
  
  HEALTHCHECK --interval=2s --timeout=5s --retries=5 \
  CMD curl -f http://localhost/ || exit 1
  ```

  

* Dockerfileì—ì„œ CMD, ENTRYPOINT ëª…ë ¹ ì‚¬ìš© ì‹œ ì£¼ì˜!
	* ENTRYPOINTì™€ CMDë¥¼ í•¨ê»˜ ì‚¬ìš©í•˜ëŠ” ê²½ìš° CMD ëª…ë ¹ì´ ENTRYPOINT ëª…ë ¹ì˜ íŒŒë¼ë¯¸í„°(ì¸ìˆ˜)ë¡œ ë¶™ìŒ
	  CMD, ENTRYPOINT ì„ ì–¸ ìˆœì„œëŠ” ìƒê´€ì—†ìŒ

    ```
    # [ì •ìƒ ë™ì‘]
    ENTRYPOINT ["./docker-entrypoint.sh"]
    CMD ["nginx", "-g", "daemon off;"]
    
    # [CMDê°€ ENTRYPOINT ëª…ë ¹ íŒŒë¼ë¯¸í„°(ì¸ìˆ˜)ë¡œ ë¶™ì–´ ì˜¤ë¥˜]
    ENTRYPOINT ["nginx", "-g", "daemon off;"]
    CMD ["./docker-entrypoint.sh"]
    
    # [CMDê°€ ENTRYPOINT ëª…ë ¹ íŒŒë¼ë¯¸í„°(ì¸ìˆ˜)ë¡œ ë¶™ì–´ ì˜¤ë¥˜]
    # ëª…ë ¹ì˜ ìˆœì„œëŠ” ìƒê´€ ì—†ìŒ
    CMD ["./docker-entrypoint.sh"]
    ENTRYPOINT ["nginx", "-g", "daemon off;"]
    
    # [ì •ìƒ ë™ì‘]
    # ëª…ë ¹ì˜ ìˆœì„œëŠ” ìƒê´€ ì—†ìŒ
    CMD ["nginx", "-g", "daemon off;"]
    ENTRYPOINT ["./docker-entrypoint.sh"]
    ```

* Dockerfileì—ì„œ ì‹¤í–‰í•  ì…¸ ìŠ¤í¬ë¦½íŠ¸ `docker-entrypoint.sh` ì‘ì„±

  ```
  #!/bin/bash #!/bin/sh
  
  echo "Connection Established"
  ```

  

* ìƒì„±í•œ Dockerfileì„ ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ ìƒì„±

  - `$ sudo docker image build -t kangj/portfolio:1.0 .`

* Dockerhub ë¡œê·¸ì¸

  - `$ sudo docker login`

* Dockerhubì— ìƒì„±í•œ ì´ë¯¸ì§€ push

  - ```
    $ sudo docker push kangj/portfoilo:1.0
    ```

    - `$ sudo docker push kangj/portfolio:tagname`
    - `$ sudo docker <ê³„ì •ëª…>/<ì €ì¥ì†Œëª…>:[íƒœê·¸]`

* push ì¤‘ ê¶Œí•œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²½ìš°

    ```
    Error loading config file: /home/kangj/.docker/config.json: open /home/kangj/.docker/config.json: permission denied
    ```

	* í•´ë‹¹ ê²½ë¡œì—ì„œ `$ ls -al` ëª…ë ¹ìœ¼ë¡œ ì†Œìœ  ê³„ì •, ê·¸ë£¹ ë“± ê¶Œí•œ í™•ì¸ 

      - `$ sudo chgrpdocker /home/kangj/.docker/config.json`
      - `$ sudo chmod g+r /home/user/.docker/config.json`

	* `Dockerhub` ì—ì„œ ì—…ë¡œë“œ ëœ ë„ì»¤ ì´ë¯¸ì§€ í™•ì¸

* ë„ì»¤ ngnix ì‹¤í–‰ í™•ì¸

  - ```
    $ sudo docker container run -p 80:80 kangj/portfolio:1.0
    ```

    - `$ sudo docker container run [OPTIONS] IMAGE [COMMAND] [ARG...]`

  - ë¸Œë¼ìš°ì €ì—ì„œ `http://172.16.248.2:80` ì ‘ì†í•˜ì—¬ `nginx` ì‹¤í–‰ í™•ì¸