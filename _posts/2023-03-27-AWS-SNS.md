---
key: jekyll-text-theme
title: 'AWS SNS'
excerpt: 'AWS Study 서비스 정리 - AWSKRUG Beginner Certification Study 😎'
tags: [AWS, SAA, cloud, study] 
---



# Application Integration



## AWS SNS 소개

* **SNS = Simple Notification Service**
* 푸시 알림, 이메일, SMS 등 다양한 방법으로 알림 메시지를 전송하는 완전 관리형 서비스  
* 이벤트 Producer(생산자)는 하나의 SNS에만 메시지를 보낼 수 있습니다.
* 이벤트 Subscriber(구독자)는 해당 topic으로 전송된 메시지 모두 받을 수 있습니다.
  * 주제별로 최대 1,200만 이상의 구독자까지 가능

## AWS SNS

<img src = "https://user-images.githubusercontent.com/113915835/228419815-bf66ef83-c386-4b14-9cf5-8e9145b4a755.png" width = "80%">



##  AWS SNS 특징

* SNS는 SQS와 같은 특정 AWS 서비스와 통합하여 메시지를 대기열로 직접 보낼 수 있습니다.

* 메시지를 수신한 후 함수가 코드를 수행하도록 Lambda에 보내거나 Firehose를 통해 데이터를 Amazon S3나 Redshift로 보낼 수도 있습니다.

* SNS는 다양한 AWS 서비스에서 데이터를 수신하기도 합니다.



### Publish 방법

* **Topic Publish (Using sdk)**
  * SDK를 사용하여 SNS 토픽 게시
    * 먼저 주제를 만든 다음 하나 또는 여러 개의 구독을 만들고 SNS 주제에 게시하면 됨
    * 모든 구독자가 자동으로 해당 메시지를 받을 수 있음
* **Direct Publish (For mobile apps SDK)** 
  * SDk를 이용하여 Endpoint에 직접 메시지 게시
    * 플랫폼 애플리케이션을 만들기 -> 플랫폼 Endpoint 만들기 -> 플랫폼 Endpoint에 게시
  * 수신 가능 대상: Google, GCM, Apple APNS, Amazon ADM 구독자
  * 모두 모바일 에플리케이션으로 알림을 수신할 수 있음.



## Security

* **Encryption**

  * HTTPS API 전송 중 암호화
  * KMS keys 활용한 저장 데이터 암호화
  * Client-side 암호화

* **Access Controls** 

  * 액세스 제어는 IAM 정책 중심 (모든 SNS API가 IAM 정책으로 규제되기 때문)

* **SNS Access Policies**

  * SNS 주제에 교차 계정 액세스 권한을 갖거나 S3 이벤트와 같은 서비스가 SNS 주제에 작성할 수 있도록

    허용하려는 경우 매우 유용

```
AWS SQS와 AWS SNS 보안은 서로 동일함. 암호화와 암호화 해독은 클라이언트가 해야 함.
```

## SNS  +  SQS: Fan Out

<img src = "https://user-images.githubusercontent.com/113915835/228423254-e1e344a9-b722-4ec3-a507-ccc6d5e94734.png" width = "80%">

* 아래와 같은 경우에 SNS  +  SQS: Fan Out 패턴을 사용합니다.

  * 메시지를 여러 SQS 대기열로 보내고 싶은데 모든 SQS 대기열에개별적으로 메시지를 보내면 문제가 발생할 수 있음 
  * 애플리케이션이 중간에 비정상적으로 종료될 수도 있고 전달에 실패한다거나 SQS 대기열이 더 추가될 수도 있음

* Access Polices 필요

* 리전 간 전달 가능

  

### 사례1

<img src = "https://user-images.githubusercontent.com/113915835/228423601-378131ea-51c9-48fa-b5ed-6f5078e3f923.png" width = "80%">

- 이벤트 유형과 접두사 조합이 동일할 경우 이벤트 규칙은 하나인데, 여러 대기열에 동일한 S3 이벤트 알림을 보내고 싶을 때 사용할 수 있습니다.
- 이 패턴으로  S3에서 발생하는 이벤트의 메시지가 여러 다른 목적지에 도달할 수 있습니다.
- S3 객체를 생성하여 S3 버킷에 이벤트를 형성하고, 이 이벤트를 SNS 주제로 전송한 후 팬아웃 패턴으로 많은 SQS 대기열이 SNS 주제를 구독하게 합니다. 이런 식으로 팬아웃 패턴 덕분에 Amazon S3에서 발생하는 이벤트의 메시지가 여러 다른 목적지에 도달할 수 있게 됩니다. (물론 다른 유형의 애플리케이션, 이메일, Lambda 함수 등도 구독할 수 있습니다.)



### 사례2

<img src = "https://user-images.githubusercontent.com/113915835/228423792-b93aa9f9-1b81-4d71-b7cc-877323c29a0e.png" width = "80%">

* 위와 같은 방식으로 SNS 주제의 메시지를 계속 이어가도록 확장할 수 있습니다.
	* 다른 아키텍처에서는 Kinesis Data Firehose (KDF)를 통해 SNS에서 Amazon S3로 직접 데이터를 전송할 수 있습니다. 
	* SNS를 KDF에 직접 연결하여 구매 서비스에서 데이터를 SNS 주제로 전송할 수 있습니다.
	* 그런 다음 Kinesis Data Firehose, 즉 KDF에서 해당 정보를 수신하고 해당 KDF에 Amazon S3 버킷으로 전달하거나 특정한 KDF 목적지로 어디든 전달할 수 있습니다.


<br/>

> **REFERENCE**
>
> [https://www.udemy.com/](https://www.udemy.com/) (AWS Certified Solutions Architect Associate, Stephane Maarek)
>
> [https://docs.aws.amazon.com/?nc2=h_ql_doc_do](https://docs.aws.amazon.com/?nc2=h_ql_doc_do)